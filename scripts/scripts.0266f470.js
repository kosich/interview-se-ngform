"use strict";angular.module("soformApp",["ngRoute","ngAnimate","mgcrea.ngStrap","seDirectives"]).config(["$routeProvider",function(a){a.when("/corrections",{templateUrl:"views/tabs/cor-act.html",controller:"corAct"}).when("/general",{templateUrl:"views/tabs/gen-info.html",controller:"genInfo"}).when("/submit",{templateUrl:"views/tabs/submit.html",controller:"submit"}).otherwise({redirectTo:"/general"})}]).run(["$rootScope","$location",function(a,b){a.$on("$routeChangeSuccess",function(){a.tabRoute=b.path()}),a.log=console.log.bind(console)}]),angular.module("seDirectives",[]).directive("seCheckboxGroup",function(){return{restrict:"E",scope:{field:"=seField"},templateUrl:"scripts/directives/checkboxGroup.html",controller:"seCheckboxGroupController",link:function(){}}}).controller("seCheckboxGroupController",["$scope",function(a){function b(){f=a.field,f.value=f.value||[],a.noneApply=f.value.indexOf(g)>=0,a.options=[],a.field.def.options.forEach(function(b,d){a.options.push({title:b,value:f.value.indexOf(b)>=0}),a.$watch("options["+d+"].value",c)})}function c(a,b){a!=b&&e()}function d(b,c){b!=c&&(b&&a.options.forEach(function(a){a.value=!1}),e())}function e(){var b;a.noneApply?b=[g]:(b=a.options.filter(function(a){return a.value}).map(function(a){return a.title}),b.length||(b=void 0)),f.value=b}var f,g="None apply";a.$watch("field",b),a.$watch("noneApply",d),b()}]),angular.module("soformApp").factory("incidentDataStructure",[function(){return{views:[{name:"default",fields:["incidentDate","reportedBy","company"]}],fields:[{name:"incidentDate",title:"Date and Time of Incident",required:!0,dataType:"Date",fieldType:"DateTime",fieldFormat:"MM/dd/yyyy hh:mm AM/PM"},{name:"reportedBy",title:"Reported By",required:!0,dataType:"String",fieldType:"Text"},{name:"company",title:"Company of Reporter",required:!0,dataType:"String",fieldType:"DropDown",options:[{value:"First Company"},{value:"Second Company"},{value:"Third Company"}]},{name:"contactPhone",title:"Contact Number",required:!0,pattern:/^\s*\d{3}\.\d{3}\.\d{4}\s*$/,dataType:"String",fieldType:"phone",tooltip:"format as YYY.ZZZ.XXXX"},{name:"supervisor",title:"Supervisor Name",dataType:"String"},{name:"description",title:"High Level Description of Incident",required:!0,dataType:"String",fieldType:"TextArea"},{name:"wellNumber",title:"Well Number",required:!0,dataType:"String",fieldType:"DropDown",options:[{value:"Well-01"},{value:"Well-02"},{value:"Well-03"}]},{name:"region",title:"Region",required:!0,dataType:"String"},{name:"state",title:"State",required:!0,dataType:"String"},{name:"office",title:"Office",required:!0,dataType:"String"},{name:"incidentSet",title:"Incident Severity (Check all that Apply)",dataType:"Array",required:!0,options:["Loss of well control","Fatality(ies)","Hospitalisation","Spill"]}],details:[{title:"Correction for the incident application",name:"Corrections",required:!0,limit:5,itemDefinition:{fields:[{name:"description",title:"Description of corrective action",required:!0,dataType:"String",fieldType:"TextArea"},{name:"actor",title:"Action taken by (name)",required:!0,dataType:"String"},{name:"company",title:"Company",required:!0,dataType:"String",fieldType:"DropDown",options:[{value:"Company A"},{value:"Company B"},{value:"Company C"}]},{name:"date",title:"Date",required:!0,dataType:"Date",fieldType:"Date",fieldFormat:"MM/dd/yyyy"}]}}]}}]),angular.module("soformApp").factory("formDataGenerator",[function(){function a(c,d){var e={fields:{},details:{},def:d};return d.fields&&d.fields.forEach(function(a){var b;c.fields&&c.fields[a.name]&&(b=c.fields[a.name]),e.fields[a.name]={name:a.name,value:b,def:a}}),d.details&&d.details.forEach(function(b){var d={name:b.name,items:[],def:b};e.details[b.name]=d,c.details&&c.details[b.name]&&c.details[b.name].items&&c.details[b.name].items.forEach(function(c){d.items.push(a(c,b.itemDefinition))})}),e.strip=b,e}function b(){var a=this,c={};return a.def.fields&&a.fields&&(c.fields={},a.def.fields.forEach(function(b){a.fields[b.name]&&null!=a.fields[b.name].value&&(c.fields[b.name]=a.fields[b.name].value)})),a.def.details&&a.details&&(c.details={},a.def.details.forEach(function(d){if(a.details[d.name]&&a.details[d.name].items){c.details[d.name]={};var e=c.details[d.name].items=[];a.details[d.name].items.forEach(function(a){e.push(a.def?b.apply(a):a)})}})),c}return{create:function(b){return a({},b)},open:function(b,c){return a(b,c)},strip:function(a){return b.apply(a)}}}]),angular.module("soformApp").factory("localStorage",function(){var a="incidents";return{get:function(){return JSON.parse(localStorage.getItem(a)||"[]")},put:function(b){localStorage.setItem(a,JSON.stringify(b))}}}),angular.module("soformApp").controller("main",["$scope","formDataGenerator","incidentDataStructure","localStorage",function(a,b,c,d){a.list=d.get(),a.definition=c,a.data=b.create(c),a.open=function(d){d?a.data=b.open(d,c):a.create()},a.create=function(){a.data=b.create(c)},a.save=function(){var b=a.list,c=a.data.strip();b.push(c),d.put(b)},a.remove=function(b){a.list.splice(a.list.indexOf(b),1),d.put(a.list)}}]),angular.module("soformApp").factory("converter",[function(){return{convert:function(a){var b={workflowCreationInformation:{workflowTypeName:"Incident Report",name:"Report - "+(new Date).toISOString()},workflowStepUpdateInformation:{stepIdOrName:"Initial Step",fields:[]}},c=b.workflowStepUpdateInformation.fields;return a.def.fields.forEach(function(b){var d=a.fields[b.name];d&&null!=d.value&&c.push({name:b.title||"NO TITLE PROVIDED",values:[d.value]})}),a.def.details.forEach(function(b){var d=a.details[b.name];d&&d.items.forEach(function(a,b){a.def.fields.forEach(function(d){var e=a.fields[d.name];e&&c.push({name:d.title+" ("+(b+1)+")"||"NO TITLE PROVIDED",values:[e.value]})})})}),JSON.stringify(b)}}}]),angular.module("soformApp").service("validator",function(){function a(a){var c=!0;return a.def.fields.forEach(function(d){var e=a.fields[d.name];e.invalid=!1,d.required&&(b(e)||(e.invalid=!0,c=!1,e.validationError="This field is required"))}),c}function b(a){return null!=a.value&&0!=a.value.length}return{validate:a}}),angular.module("soformApp").factory("sender",["$modal",function(a){return{send:function(b){console.log(b),a({title:"Data, going to the workflow system",content:b,show:!0})}}}]),angular.module("soformApp").controller("corAct",["$scope","formDataGenerator",function(a,b){function c(){e=a.data.details.Corrections,a.detail=e,a.itemsDefinitions=e.def.itemDefinition.fields,a.item=d()}function d(){var a=b.create(e.def.itemDefinition);return a}a.editingIndex;var e;a.$watch("data",c),a.saveItem=function(b){angular.copy(a.item);a.editing?(angular.extend(e.items[a.editingIndex],a.item),a.editing=!1):e.items.push(a.item),a.item=d(),b&&(b.$setPristine(),b.$setUntouched())},a.edit=function(b,c){a.editingIndex=c,a.editing=!0;var d=angular.copy(b);a.item=d},a.cancel=function(b){a.item=d(),a.editing=!1,b&&(b.$setPristine(),b.$setUntouched())},a.remove=function(a){e.items.splice(e.items.indexOf(a),1)}}]),angular.module("soformApp").controller("genInfo",["$scope",function(a){function b(){c=a.f=a.data.fields,a.contactPhonePattern=new RegExp(c.contactPhone.def.pattern)}var c;a.$watch("data",b);var d={"Well-01":{region:"South",state:"Oklahoma",office:"Ringwood"},"Well-02":{region:"North",state:"Montana",office:"Sidney"},"Well-03":{region:"North",state:"North Dakota",office:"Tioga"}};a.$watch("f.wellNumber.value",function(a,b){if(a!=b){var e=d[a];e&&Object.keys(e).forEach(function(a){c[a].value=e[a]})}}),b()}]),angular.module("soformApp").controller("submit",["$scope","localStorage","validator","converter","sender",function(a,b,c,d,e){function f(){a.valid=c.validate(a.data)}a.$watch("data",f),a.fieldValidity=function(a){return a.invalid?a.validationError:a.value},a.send=function(){var b=d.convert(a.data);a.modal={title:"Raw docflow data",content:b},e.send(b)},f()}]);